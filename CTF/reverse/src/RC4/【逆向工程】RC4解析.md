# 【逆向工程】RC4解析

## 概念

**RC4**（Rivest Cipher 4）是一种**对称流密码**（Symmetric Stream Cipher），由 Ron Rivest 设计，广泛用于早期的 SSL/TLS、WEP 等协议中。

> RC4的优点是速度快、实现简单；缺点是安全性随时间下降，现在已不推荐在新系统中使用

对称加密的核心思想：

- 加密和解密使用**相同的密钥**
- 发送方：明文 + 密钥 → 密文
- 接收方：密文 + 相同密钥 → 明文

## 密钥流

密钥流（Keystream）是“**流密码**”特有的概念

在流密码中，密钥是一个字符串（更严谨表达是字节序列，不一定是人类可读的字符串），将密钥通过某种算法得到一个理论上可以无限长的伪随机字节序列，这个序列称为**密钥流**。

加/解密都是和密钥流进行操作，而不是密钥本身

> 密钥-----调度算法----->密钥流

## 特性

**密钥**长度可变，范围是1-256字节

**密钥流**是由密钥和密钥长度决定

生成的**密钥流**的长度和明文的长度是对应的

## 加密过程

### KSA

Key Scheduling Algorithm（密钥调度算法），作用是用密钥打乱初始化的S数组

### PRGA

PRGA（Pseudo-Random Generation Algorithm）作用就是基于这个被打乱的 S，不断输出伪随机字节序列（密钥流）

## 特征识别

有很多256取模运算

也有可能在细节处有魔改，基本上都是添加新的异或